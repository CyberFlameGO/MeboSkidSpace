package secondlife.network.paik.handlers.fixes;

import org.bukkit.Bukkit;
import org.bukkit.Material;
import org.bukkit.enchantments.Enchantment;
import org.bukkit.entity.Player;
import org.bukkit.event.EventHandler;
import org.bukkit.event.Listener;
import org.bukkit.event.player.PlayerEditBookEvent;
import org.bukkit.event.player.PlayerInteractEvent;
import org.bukkit.inventory.ItemStack;

import secondlife.network.paik.Paik;
import secondlife.network.paik.utils.Handler;

public class BookExploitHandler extends Handler implements Listener {

	public BookExploitHandler(Paik plugin) {
		super(plugin);

		Bukkit.getPluginManager().registerEvents(this, plugin);
	}

	@EventHandler
	public void onPlayerInteract(PlayerInteractEvent event) {
		Player player = event.getPlayer();
		ItemStack item = player.getItemInHand();
		
		if(item == null) return;
		if((item.getType() != Material.BOOK_AND_QUILL) && (item.getType() != Material.WRITTEN_BOOK)) return;
		
		if(item.getEnchantments().size() > 0) {
			for(Enchantment enchant : item.getEnchantments().keySet()) {
				item.removeEnchantment(enchant);
			}

			event.setCancelled(true);
			player.getInventory().removeItem(new ItemStack[] { item });
		}
	}

	@EventHandler
	public void onPlayerEditBook(PlayerEditBookEvent event) {
		if (event.getNewBookMeta().getEnchants().size() > 0) {
			event.setCancelled(true);
			
			Player player = event.getPlayer();
			
			player.getInventory().remove(Material.BOOK_AND_QUILL);
		}
	}
}